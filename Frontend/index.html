<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Event Registration</title>
  <style>
    body { font-family: 'Poppins', sans-serif; background: #f9fafb; padding: 20px; }
    .form-container { background: white; padding: 25px; border-radius: 12px; max-width: 500px; margin: auto; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    input, select { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 15px; }
    button:disabled { opacity: 0.6; cursor: not-allowed; }

    /* Toast styles */
    #toast {
      visibility: hidden;
      min-width: 250px;
      background-color: #16a34a;
      color: white;
      text-align: center;
      border-radius: 8px;
      padding: 12px;
      position: fixed;
      z-index: 10000;
      left: 50%;
      bottom: 40px;
      transform: translateX(-50%);
      font-weight: 500;
      transition: all 0.4s ease;
    }
    #toast.show { visibility: visible; bottom: 60px; opacity: 1; }
  </style>
</head>
<body>

<div class="form-container">
  <h2 style="text-align:center;">Register for Event</h2>

  <label>Name</label>
  <input type="text" id="name" placeholder="Enter your full name" required>

  <label>Email</label>
  <input type="email" id="email" placeholder="Enter your email" required>

  <label>Phone Number</label>
  <input type="tel" id="phone" placeholder="Enter your phone number" required>

  <label>Select Event</label>
  <select id="event" required>
    <option value="">-- Choose Event --</option>
    <option value="Soakers">Soakers</option>
    <option value="Monochrome">Monochrome</option>
    <option value="Vibe The Fest">Vibe The Fest</option>
  </select>

  <div style="text-align:center; margin-top:20px;">
    <button id="openWinGame" style="background:#ef4444; color:white; border:none; border-radius:8px; padding:10px 20px; font-size:16px; cursor:pointer; font-weight:600;">WIN THE GAME</button>
    <div id="selectedDisplay" style="margin-top:10px; font-size:15px; color:#1e293b; font-weight:500; min-height:20px;">No numbers selected yet.</div>
  </div>

  <div style="text-align:center; margin-top:20px;">
    <button id="submitBtn" style="background-color:#2563eb; color:white; border:none; border-radius:8px; padding:10px 20px; font-size:16px; font-weight:600; cursor:pointer;">I Don Ready</button>
  </div>
</div>

<!-- Toast Notification -->
<div id="toast"></div>

<!-- Confirmation Overlay -->
<div id="confirmOverlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:9999; justify-content:center; align-items:center;">
  <div style="background:white; border-radius:12px; padding:20px 25px; width:90%; max-width:400px; box-shadow:0 4px 10px rgba(0,0,0,0.3); text-align:left;">
    <h3 style="margin-top:0;">Confirm Your Information</h3>
    <p id="confirmText" style="line-height:1.6;"></p>
    <div style="text-align:right; margin-top:20px;">
      <button id="cancelBtn" style="background:#ef4444; color:white; border:none; border-radius:8px; padding:8px 14px; font-weight:600; cursor:pointer; margin-right:8px;">Cancel</button>
      <button id="confirmBtn" style="background:#22c55e; color:white; border:none; border-radius:8px; padding:8px 14px; font-weight:600; cursor:pointer;">Confirm</button>
    </div>
  </div>
</div>

<script>
  const BACKEND_URL = "https://nicketbackend.onrender.com";
  const pricePerNumber = 1000;
  let selectedNumbers = [];

  const overlay = document.getElementById('confirmOverlay');
  const confirmBtn = document.getElementById('confirmBtn');
  const cancelBtn = document.getElementById('cancelBtn');
  const confirmText = document.getElementById('confirmText');
  const submitBtn = document.getElementById('submitBtn');
  const toast = document.getElementById("toast");

  function showToast(message, success = true) {
    toast.textContent = message;
    toast.style.backgroundColor = success ? "#16a34a" : "#ef4444";
    toast.className = "show";
    setTimeout(() => toast.className = toast.className.replace("show", ""), 3000);
  }

  function clearForm() {
    document.getElementById('name').value = "";
    document.getElementById('email').value = "";
    document.getElementById('phone').value = "";
    document.getElementById('event').value = "";
    selectedNumbers = [];
    document.getElementById("selectedDisplay").textContent = "No numbers selected yet.";
  }

  submitBtn.addEventListener("click", () => {
    const name = document.getElementById('name').value.trim();
    const email = document.getElementById('email').value.trim();
    const phone = document.getElementById('phone').value.trim();
    const eventValue = document.getElementById('event').value.trim();

    if (!name || !email || !phone || !eventValue || selectedNumbers.length === 0) {
      showToast("⚠️ Please fill all fields and select numbers.", false);
      return;
    }

    confirmText.innerHTML = `
      <strong>Name:</strong> ${name}<br>
      <strong>Email:</strong> ${email}<br>
      <strong>Phone:</strong> ${phone}<br>
      <strong>Event:</strong> ${eventValue}<br>
      <strong>Selected Numbers:</strong> ${selectedNumbers.join(", ")}<br>
      <strong>Total:</strong> ₦${(selectedNumbers.length * pricePerNumber).toLocaleString()}<br><br>
      Please confirm all details are correct.
    `;
    overlay.style.display = "flex";
  });

  cancelBtn.onclick = () => overlay.style.display = "none";
  overlay.onclick = (e) => { if (e.target === overlay) overlay.style.display = "none"; };

  confirmBtn.addEventListener("click", async () => {
    confirmBtn.disabled = true;
    confirmBtn.textContent = "Sending...";

    const name = document.getElementById('name').value.trim();
    const email = document.getElementById('email').value.trim();
    const phone = document.getElementById('phone').value.trim();
    const eventValue = document.getElementById('event').value.trim();
    const totalValue = selectedNumbers.length * pricePerNumber;

    try {
      const response = await fetch(`${BACKEND_URL}/submit`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, email, phone, eventValue, selectedNumbers, totalValue }),
      });

      const result = await response.json();

      if (response.ok) {
        overlay.style.display = "none";
        clearForm();
        showToast(`✅ Thanks, ${name}! Confirmation sent to ${email}.`);
      } else {
        showToast(`❌ ${result.message || "Failed to send email."}`, false);
      }
    } catch (err) {
      showToast("⚠️ Could not connect to server.", false);
    }

    confirmBtn.disabled = false;
    confirmBtn.textContent = "Confirm";
  });
</script>

</body>
</html>
